{% extends "layout.html" %}
{% block content %}

<script src="https://code.jquery.com/jquery-3.1.0.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.1/html2pdf.bundle.min.js"></script>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
     /* Popup container - can be anything you want */
     .popup {
         position: relative;
         display: inline-block;
         cursor: pointer;
         -webkit-user-select: none;
         -moz-user-select: none;
         -ms-user-select: none;
         user-select: none;
     }

     /* The actual popup */
     .popup .popuptext {
         visibility: hidden;
         width: 800px;
         background-color: #555;
         font-size: 12pt;
         color: #fff;
         text-align: left;
         border-radius: 12px;
         padding: 20px 20px;
         position: absolute;
         z-index: 1;
         bottom: 125%;
         left: 10%;
         margin-left: 80px;
     }

     /* Popup arrow */
     .popup .popuptext::after {
         content: "";
         position: absolute;
         top: 100%;
         left: 9.5%;
         margin-left: -5px;
         border-width: 5px;
         border-style: solid;
         border-color: #555 transparent transparent transparent;
     }

     /* Toggle this class - hide and show the popup */
     .popup .show {
         visibility: visible;
         -webkit-animation: fadeIn 1s;
         animation: fadeIn 1s;
     }

     /* Show the tooltip text when you mouse over the tooltip container */
     .popup:hover .popuptext {
         visibility: visible;
     }

     /* Add animation (fade in the popup) */
     @-webkit-keyframes fadeIn {
         from {
             opacity: 0;
         }

         to {
             opacity: 1;
         }
     }

     @keyframes fadeIn {
         from {
             opacity: 0;
         }

         to {
             opacity: 1;
         }
     }

     table {
         border-collapse: collapse;
         border-spacing: 0;
         width: 600px;
         height: 600px;
         overflow: scroll;
         border: 1px solid #ddd;
     }

     th, td {
         text-align: left;
         padding: 16px;
     }

     tr:nth-child(even) {
         background-color: #f2f2f2;
     }
    </style>
</head>

<div id="home" class="container mx-auto p-4">
    <div class="flex flex flex-col space-y-4">

        <script src="../../static/js/jquery-3.5.1.min.js"></script>

        <!-- Method to change the visable sections -->
        <script>
         $(document).ready(function () {
             $("div.methodology_desc").hide();

             $("#kde_Input").hide();
             $("#csv_Title").hide();
             $("#csv_Null_Title").hide();
             $("#csv_Null_Results").hide();
             $("#csv_Class_Balance_Title").hide();
             $("#csv_Class_Balance_Results").hide();
             $("#csv_Scale_Title").hide();
             $("#csv_Scale_Results").hide();

             $("#kde_Input_Preopt").hide();
             $("#csv_Title_Preopt").hide();
             $("#csv_Null_Title_Preopt").hide();
             $("#csv_Null_Results_Preopt").hide();
             $("#csv_Class_Balance_Title_Preopt").hide();
             $("#csv_Class_Balance_Results_Preopt").hide();
             $("#csv_Scale_Title_Preopt").hide();
             $("#csv_Scale_Results_Preopt").hide();

             $("input[name$='methodology' ]").click(function () {
                 var methodology = $(this).val();
                 var num = 0
                 var count = 1

                 if (methodology == "MLA") {
                     $("div.methodology_desc").hide();
                     $("#MLA_Options").show();
                 }

                 if (methodology == "DLANN") {
                     $("div.methodology_desc").hide();
                     $("#DLANN_Options").show();
                 }
             });
         });

        </script>


        <!-- Goal and Scope -->
        <div class="flex flex-col space-y-4 mb-2 mt-4 py-4 px-2 border-b border-gray-400">
            <h1 class="mb-2 font-bold text-xl">Goal and Scope</h1>

            <h4 class="mb-2 max-w-xs font-medium flex flex-row">
                <span class="mr-2">Project Name</span>
                <div class="flex flex-row">
                    <div class="popup flex flex-row space-x-2" onclick="popupInformation('Experiment_Name_Info')">
                        <img src="../../static/Images/information_icon.png"
                             class="popup"
                             width="20"
                             height="20" />
                        <span class="popuptext" id="Experiment_Name_Info">Project name that will be used for future reference.</span>
                    </div>

            </h4>
            <!-- information to display for the name of the project -->
            <input class="w-64 px-2 py-1 border border-gray-400 rounded-lg bg-white" id="projectName" type="text" name="projectName" placeholder="Name of the project">

            <div class="">
                <div class="flex flex-row">
                    <h3 class="mb-2 font-medium ">Goal and Scope</h3>
                    <!-- information to display for the definition of the project -->
                    <div class="popup" onclick="popupInformation('Experiment_Definition_Info')">
                        <img src="../../static/Images/information_icon.png"
                             width="20"
                             height="20" />
                        <span class="popuptext" id="Experiment_Definition_Info">Project definition. Will be shown for viewer`s understanding when displaying the results.
                        </span>
                    </div>
                </div>

                <textarea id="phase1Text"
                          name="phase1Text" rows="3" cols="50"
                          class="resize w-64 px-2 py-1 border border-gray-400 rounded-lg bg-white"
                ></textarea>
            </div>

                </div>


                <!-- Dataset section -->
                <div class="border-b border-gray-400 p-2">
                    <h1 class="mb-2 font-bold text-xl">Data</h1>
                    <form id="csvForm">
                        <div class="mb-2">
                            Data Type:
                            {% if g.Data_Types %}
                            <select id="types"
                                    class="px-2 py-1 mr-2 rounded-md border border-gray-400"
                                    name="Types" onchange="changeDataType(this.id)">
                                {% for choices, names, infos in g.Data_Types%}
                                <option value={{ choices }}>{{ names }}</option>
                                {% endfor %}
                            </select>
                            {% endif %}
                        </div>

                        <div class="flex flex-col">
                            <div class="flex flex-row">
                                <h3 class="mr-2">File </h3>
                                <!-- information to display for the loadable dataset -->
                                <div class="popup" onclick="popupInformation('Experiment_Dataset_Info')">
                                    <img src="../../static/Images/information_icon.png"
                                         width="20"
                                         height="20" />
                                    <span style="white-space: pre-wrap" class="popuptext" id="Experiment_Dataset_Info">File to load for cycon project. <br><br> Currently accepts CSVs (comma-separated values) only.</span>
                                </div>
                            </div>

                            <input type="file"
                                   id="csvFile"
                                   class="input-csv selection-csv mb-2 file:px-2 file:py-1 file:my-1 file:bg-violet-500 file:text-white file:font-medium file:text-sm file:rounded-full file:border-none"
                                   name="csvFile" accept=".csv" onchange="changeCSV()">

                        </div>
                        <div id="class_col_section"></div>

                        <div id="kde_Input">
                            <label>Kernel Density Estimates (KDE) ind value. (optional)</label>
                            <div class="popup" onclick="popupInformation('KDE_IND_Info')">
                                <img src="../../static/Images/information_icon.png"
                                     width="20"
                                     height="20" />
                                <span style="white-space: pre-wrap" class="popuptext" id="KDE_IND_Info">A kernel density estimate (KDE) plot is a method for visualizing the distribution of observations in a dataset, analogous to a histogram. KDE represents the data using a continuous probability density curve in one or more dimensions.<br><br>Relative to a histogram, KDE can produce a plot that is less cluttered and more interpretable, especially when drawing multiple distributions. But it has the potential to introduce distortions if the underlying distribution is bounded or not smooth. Like a histogram, the quality of the representation also depends on the selection of good smoothing parameters.<br><br>Evaluation points for the estimated PDF. If None (default), 1000 equally spaced points are used. If ind is a NumPy array, the KDE is evaluated at the points passed. If ind is an integer, ind number of equally spaced points are used.\n\nGiving an int value will calculate the KDE for all columns when considering each class.</span>
                            </div>
                            <input id="kde_ind"
                                   class="w-64 px-2 py-1 border border-gray-400 rounded-lg bg-white"
                                   type="text" name="kde_ind"> <br>
                        </div>

                        <button type="submit"
                                class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                name="submit"> Check </button>

                        <p id="csv_Error"></p>
                        <p id="csv_Title">CSV values:</p>
                        <div style="overflow: auto; max-height: 1000px; max-width: 1100px; ">
                            <p id="csv_Results" style="background-color: white;"></p>
                        </div>
                        <p id="csv_Null_Title">Null instances:</p>
                        <p id="csv_Null_Results" style="background-color: white;"></p>
                        <p id="csv_Class_Balance_Title">Number of Class Instances:</p>
                        <p id="csv_Class_Balance_Results" style="background-color: white;"></p>
                        <p id="csv_Scale_Title">KDE plots for each class:</p>
                        <div style="overflow: auto; max-height: 600px; max-width: 600px; ">
                            <p id="csv_Scale_Results" style="background-color: white;"></p>
                        </div>
                    </form>
                </div>


                <!-- Preprocess section-->
                <div class="border-b border-gray-400 p-2">
                    <h1 class="mb-2 font-bold text-xl">Preprocessing (Optional)</h1>
                    <form id="preoptForm">

                        <!-- Dynamically pull preoptimization options and create new identifyer when selected. -->
                        Category:
                        {% if g.preopt_Categories %}
                        <select id="preopt_categories"
                                class="px-2 py-1 mr-2 rounded-md border border-gray-400"
                                name="preopt_categories" onchange="changePreoptCategory(this.id,'preopts')">
                            {% for choices, names, infos in g.preopt_Categories%}
                            <option value={{ choices }}>{{ names }}</option>
                            {% endfor %}
                        </select>
                        {% endif %}
                        Optimizer:
                        {% if g.preopts %}
                        <select id="preopts"
                                class="px-2 py-1 mr-2 rounded-md border border-gray-400"
                                name="preopts">
                            {% for choices, names, infos in g.preopts%}
                            <option value={{ choices }}>{{ names }}</option>
                            {% endfor %}
                        </select>
                        <button type="button"
                                id="AddPreopts"
                                class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                onclick="selectPreopt('preopts', 'Preopt_Selection')">Add</button>
                        <button type="button"
                                id="clearPreopts"
                                class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                onclick="clearAllPreopt()"> Remove All </button>
                        {% endif %}

                        <div id="Preopt_Selection"></div>

                        <button type="submit"
                                class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                value="Check" onclick="changePreoptSubmit('Check')"> Check </button>

                        <p id="csv_Error_Preopt"></p>
                        <p id="csv_Title_Preopt">CSV values:</p>
                        <div style="overflow: auto; max-height: 1000px; max-width: 1100px; ">
                            <p id="csv_Results_Preopt" style="background-color: white;"></p>
                        </div>
                        <p id="csv_Null_Title_Preopt">Null instances:</p>
                        <p id="csv_Null_Results_Preopt" style="background-color: white;"></p>
                        <p id="csv_Class_Balance_Title_Preopt">Number of Class Instances:</p>
                        <p id="csv_Class_Balance_Results_Preopt" style="background-color: white;"></p>
                        <p id="csv_Scale_Title_Preopt">KDE plots for each class:</p>
                        <div style="overflow: auto; max-height: 600px; max-width: 600px; ">
                            <p id="csv_Scale_Results_Preopt" style="background-color: white;"></p>
                        </div>

                        <button type="submit"
                                class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                value="Download" onclick="changePreoptSubmit('Download')"> Download </button>
                    </form>
                </div>


                <!-- MLA -->
                <div class="border-b border-gray-400 p-2">
                    <form id="cyconForm">
                        <!-- Copy of information from prior sections -->
                        <input id="projectName_copy" name="projectName" type="hidden" />
                        <input id="phase1Text_copy" name="phase1Text" type="hidden" />
                        <input id="csvFile_copy" name="csvFile" type="hidden" />

                        <!-- Methodology section 1 -->
                        {% if g.Methodologies %}
                        <h1 class="mb-2 font-bold text-xl">Method</h1>

                        {% for choices, name, infos in g.Methodologies%}
                        <input type="radio" id={{ choices }} name="methodology" value={{ choices }}> <label for={{ choices }}>{{ name }}</label>
                        {% for sentence in infos%}
                        {% if sentence != null and sentence != ""%}
                        <!-- information to display for the selectable methodology section
                             Its a mess and will need to fix later as the onclick will not accept variables...-->
                        {% if "MLA" in choices%}
                        <div class="popup" onclick="popupInformation('MLA_info')">
                            <img src="../../static/Images/information_icon.png"
                                 width="20"
                                 height="20" />
                            <span style="white-space: pre-wrap" class="popuptext" id="MLA_info" }>{{ sentence }}</span>
                        </div>
                        <br>
                        {% endif %}
                        {% if "DLANN" in choices%}
                        <div class="popup" onclick="popupInformation('DLANN_info')">
                            <img src="../../static/Images/information_icon.png"
                                 width="20"
                                 height="20" />
                            <span style="white-space: pre-wrap" class="popuptext" id="DLANN_info" }>{{ sentence }}</span>
                        </div>
                        <br>
                        {% endif %}
                        {% endif %}
                        {% endfor %}
                        {% endfor %}
                        {% endif %}

                        <!-- Section for MLA -->
                        <div id="MLA_Options" class="methodology_desc">

                            <!-- Dynamically pull algorithms names and create radio buttons for each choice-->
                            <br>
                            Algorithm:
                            {% if g.Algorithms %}
                            <select id="MLalgorithm"
                                    class="px-2 py-1 mr-2 rounded-md border border-gray-400"
                                    name="MLalgorithm" onchange="changeAlgorithm(this.id, 'Parameters')">
                                {% for choices, infos in g.Algorithms%}
                                <option value={{ choices }}>{{ choices }}</option>
                                {% endfor %}
                            </select>
                            {% endif %}

                            <br><br>
                            For more information on MLA algorithms, visit  <a href="https://scikit-learn.org/stable/supervised_learning.html">scikit-learn.org</a>

                            <br><br>

                            <!-- Hyperparameters section-->

                            <div id="Parameters"></div>

                            <!-- Validation section-->
                            <h1 body style="background-color: #F6B700; border: black; border-width: 3px; border-style: solid">Validation</h1>

                            <input type="radio" id=K-Fold name="validation" value=K-Fold> <label for=K-Fold>K-Fold</label>
                            <div class="popup" onclick="popupInformation('K-Fold_Info')">
                                <img src="../../static/Images/information_icon.png"
                                     width="20"
                                     height="20" />
                                <span style="white-space: pre-wrap" class="popuptext" id="K-Fold_Info" }>K-Folds cross-validator<br><br>Provides train/test indices to split data in train/test sets. Split dataset into k consecutive folds (without shuffling by default).<br><br>Each fold is then used once as a validation while the k - 1 remaining folds form the training set.<br><br>Input values is the desired number of folds.</span>
                            </div>
                            <input type="text" id="K-Fold_Input" name="K-Fold_Input">
                            <br>

                            <input type="radio" id=Split name="validation" value=Split> <label for=Split>Split</label>
                            <div class="popup" onclick="popupInformation('Split_Info')">
                                <img src="../../static/Images/information_icon.png"
                                     width="20"
                                     height="20" />
                                <span style="white-space: pre-wrap" class="popuptext" id="Split_Info" }>Split arrays or matrices into random train and test subsets.<br><br>Quick utility that wraps input validation, next(ShuffleSplit().split(X, y)), and application to input data into a single call for splitting (and optionally subsampling) data into a one-liner.<br><br>Input value is the percent set for the testing dataset given as a decimal.</span>
                            </div>
                            <input type="text" id="Split_Input" name="Split_Input">
                            <br><br>

                            <p><b>Optional Options:</b></p>
                            <label for=Random_State>Random State </label>
                            <div class="popup" onclick="popupInformation('Random_State_Info')">
                                <img src="../../static/Images/information_icon.png"
                                     width="20"
                                     height="20" />
                                <span style="white-space: pre-wrap" class="popuptext" id="Random_State_Info" }>Whether to shuffle the data before splitting into batches. Note that the samples within each split will not be shuffled.</span>
                            </div>
                            <input type="text" id="Random_State_Input" name="Random_State_Input"><br>

                            <label for=Shuffle>Shuffle </label>
                            <div class="popup" onclick="popupInformation('Random_State_Info')">
                                <img src="../../static/Images/information_icon.png"
                                     width="20"
                                     height="20" />
                                <span style="white-space: pre-wrap" class="popuptext" id="Random_State_Info" }>When shuffle is True, random_state affects the ordering of the indices, which controls the randomness of each fold. Otherwise, this parameter has no effect. Pass an int for reproducible output across multiple function calls.</span>
                            </div>
                            <input type="radio" id="Shuffle_True" name="Shuffle" value=True> <label for="Shuffle_True">True</label>
                            <input type="radio" id="Shuffle_False" name="Shuffle" value=False checked> <label for="Shuffle_False">False</label><br>

                            <label for=Shuffle>Stratify. </label>
                            <div class="popup" onclick="popupInformation('Stratify_Info')">
                                <img src="../../static/Images/information_icon.png"
                                     width="20"
                                     height="20" />
                                <span style="white-space: pre-wrap" class="popuptext" id="Stratify_Info" }>If not None, data is split in a stratified fashion, using this as the class labels.<br><br>When using split validation, set to true will statify on the class column information.<br>When usng k-fold, the method will use stratify k-fold.</span>
                            </div>
                            <input type="radio" id="Stratify_True" name="Stratify" value=True> <label for="Stratify_True">True</label>
                            <input type="radio" id="Stratify_False" name="Stratify" value=False checked> <label for="Stratify_False">False</label><br>
                        </div>

                        <!-- Section for DLANN -->
                        <div id="DLANN_Options" class="methodology_desc">
                            <!-- Dynamically pull methods names and create radio buttons for each choice
                                 <input type="radio" id=Method_BNN name="networks" value=network_BNN onclick=> <label for=Network_BNN>Basic Neural Network</label><br>
                                 <input type="radio" id=Method_CNN name="networks" value=network_CNN onclick=> <label for=Network_CNN>Convolutional Neural Network</label><br>

                                 <p>Basic Neural Network: (Info will be added later) </p>
                                 <p>Convolutional Neural Network: (Info will be added later) </p>-->

                            <!-- Methods section-->
                            <h2>Model Creation</h2><br>

                            Category:
                            {% if g.NN_layer_Categories %}
                            <select id="layer_categories"
                                    class="px-2 py-1 mr-2 rounded-md border border-gray-400"
                                    name="layer_categories" onchange="changeLayerCategory(this.id,'layers')">
                                {% for choices, names, infos in g.NN_layer_Categories%}
                                <option value={{ choices }}>{{ names }}</option>
                                {% endfor %}
                            </select>
                            {% endif %}
                            Layer:
                            {% if g.layers %}
                            <select id="layers"
                                    class="px-2 py-1 mr-2 rounded-md border border-gray-400"
                                    name="layers">
                                {% for choices, names, infos in g.layers%}
                                <option value={{ choices }}>{{ names }}</option>
                                {% endfor %}
                            </select>
                            <button type="button"
                                    class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                    id="AddLayer" onclick="selectLayers('layers', 'Layers_Selection')">Add</button>
                            <button type="button"
                                    class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                    id="clearNN" onclick="clearAllNN()"> Remove All </button>
                            {% endif %}

                            <div id="Layers_Selection"></div>

                            <button type="submit"
                                    class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                    value="Check" onclick="changePreoptSubmit('Check')"> Check </button>

                            <p id="csv_Error_Preopt"></p>

                        </div>

                        <button type="submit"
                                class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                name="submit"> Perform Experiment </button>

                    </form>
                </div>

                <!-- Metrics section-->
                <div class="border-b border-gray-400 p-2">
                    <h1 class="mb-2 font-bold text-xl">Metrics</h1>

                    <form id="resultForm">

                        <input type="checkbox" id=Met_ACC name="Met_ACC" value=Met_ACC checked> <label for=Met_ACC>ACC</label><br>
                        <input type="checkbox" id=Met_Precision name="Met_Precision" value=Met_Precision checked> <label for=Met_Precision>Precision</label><br>
                        <input type="checkbox" id=Met_Precision_Micro name="Met_Precision_Micro" value=Met_Precision_Micro checked> <label for=Met_Precision_Micro>Precision (Micro)</label><br>
                        <input type="checkbox" id=Met_Precision_Macro name="Met_Precision_Macro" value=Met_Precision_Macro checked> <label for=Met_Precision_Macro>Precision (Macro)</label><br>
                        <input type="checkbox" id=Met_F1 name="Met_F1" value=Met_F1 checked> <label for=Met_F1>F1</label><br>
                        <input type="checkbox" id=Met_F1_Micro name="Met_F1_Micro" value=Met_F1_Micro checked> <label for=Met_F1_Micro>F1 (Micro)</label><br>
                        <input type="checkbox" id=Met_F1_Macro name="Met_F1_Macro" value=Met_F1_Macro checked> <label for=Met_F1_Macro>F1 (Macro)</label><br>
                        <input type="checkbox" id=Met_CM name="Met_CM" value=Met_CM checked> <label for=Met_CM>Confusion Matrix</label><br>


                        <button type="submit"
                                class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                                name="submit">
                            Update displayed metrics
                        </button>

                    </form>
                </div>


                <!-- Results section-->
                <div class="p-2">
                    <h1 class="mb-2 font-bold text-xl">Results</h1>

                    <p id="Results" style="background-color: white;"></p>

                    Generated a PDF report
                    <button type="button"
                            class="px-2 px-1.5 rounded-lg bg-white border border-gray-400"
                            id="generateReport" onclick="generatePDF()">
                        Generate
                    </button>

                </div>
        </div>
    </div>
</div>

</div>




<!-- This is the old javascript method for running LCA. Will need to change to json file, run on pytho
     n and run on seprate vm later.-->
<script src="../../static/src/Cycon_events.js"></script>

<!-- This is the javascript method for running MLA-->
<!-- The library for the charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
{% endblock %}
