{% extends "layout.html" %}
{% block content %}

<script src="https://code.jquery.com/jquery-3.1.0.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.1/html2pdf.bundle.min.js"></script>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        /* Popup container - can be anything you want */
        .popup {
            position: relative;
            display: inline-block;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

            /* The actual popup */
            .popup .popuptext {
                visibility: hidden;
                width: 800px;
                background-color: #555;
                font-size: 12pt;
                color: #fff;
                text-align: left;
                border-radius: 12px;
                padding: 20px 20px;
                position: absolute;
                z-index: 1;
                bottom: 125%;
                left: 50%;
                margin-left: -80px;
            }

                /* Popup arrow */
                .popup .popuptext::after {
                    content: "";
                    position: absolute;
                    top: 100%;
                    left: 9.5%;
                    margin-left: -5px;
                    border-width: 5px;
                    border-style: solid;
                    border-color: #555 transparent transparent transparent;
                }

            /* Toggle this class - hide and show the popup */
            .popup .show {
                visibility: visible;
                -webkit-animation: fadeIn 1s;
                animation: fadeIn 1s;
            }

            /* Show the tooltip text when you mouse over the tooltip container */
            .popup:hover .popuptext {
                visibility: visible;
            }

        /* Add animation (fade in the popup) */
        @-webkit-keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }
        table {
            border-collapse: collapse;
            border-spacing: 0;
            width: 600px;
            height: 600px;
            overflow: scroll;
            border: 1px solid #ddd;
        }

        th, td {
            text-align: left;
            padding: 16px;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
    </style>
</head>

<div id="home" class="panel">
    <div class="main" style="width: 70%">

        <script src="../../static/js/jquery-3.5.1.min.js"></script>

        <!-- Method to change the visable sections -->
        <script>
            $(document).ready(function () {
                $("div.methodology_desc").hide();
                $("input[name$='methodology' ]").click(function () {
                    var methodology = $(this).val();
                    var num = 0
                    var count = 1

                    if (methodology == "MLA:") {
                        $("div.methodology_desc").hide();
                        $("#MLA_Options").show();
                    }

                    if (methodology == "DLANN:") {
                        $("div.methodology_desc").hide();
                        $("#DLANN_Options").show();
                    }
                });
            });
        </script>

        <!--
    <script type="text/javascript">
        function changeMethod(methods, Parameters) {
            document.getElementById("Results").innerHTML = "Hello?"
        }
    </script>
        -->
        <h1>Welcome, fill out the following information to start an experiment.</h1>

        <p id="demo"></p>

        <hr />
        <h2>Phase 1. Experiment information.</h2>
        <hr />

        <h3 id="infoHeader">
            Name of the project:
            <!-- information to display for the name of the project -->
            <div class="popup" onclick="popupInformation('Experiment_Name_Info')">
                <img src="../../static/Images/information_icon.png"
                     width="20"
                     height="20" />
                <span class="popuptext" id="Experiment_Name_Info">Project name that will be used for future reference.</span>
            </div>
        </h3>

        <tr>
            <td><input id="projectName" type="text" name="projectName" placeholder="Name of the project" /></td>
        </tr>

        <h3 id="scopeHeader">
            Goal and scope definition:
            <!-- information to display for the definition of the project -->
            <div class="popup" onclick="popupInformation('Experiment_Definition_Info')">
                <img src="../../static/Images/information_icon.png"
                     width="20"
                     height="20" />
                <span class="popuptext" id="Experiment_Definition_Info">Project definition. <br><br> Will be shown for viewer`s understanding when displaying the results.</span>
            </div>
        </h3>

        <li style="font-size:12pt">
            <b>
                Define your goal, scope, system boundary, functional unit, and case study
                assumptions down here:
            </b>
        </li>

        <textarea id="phase1Text" name="phase1Text" rows="2" cols="50">

            </textarea>
        <p>&nbsp;</p>

        <h3>-----------------------------------</h3>

        <!-- Dataset section -->
        <form id="csvForm">
            <hr />
            <h2>
                Phase 2. Load Dataset.
                <!-- information to display for the loadable dataset -->
                <div class="popup" onclick="popupInformation('Experiment_Dataset_Info')">
                    <img src="../../static/Images/information_icon.png"
                         width="20"
                         height="20" />
                    <span style="white-space: pre-wrap" class="popuptext" id="Experiment_Dataset_Info">File to load for cycon project. <br><br> Currently accepts CSVs (comma-separated values) only.</span>
                </div>
            </h2><br>
            <hr />
            <input type="file" id="csvFile" name="csvFile" accept=".csv"> <br>

            <label>Column number to use for classifying.</label>
            <div class="popup" onclick="popupInformation('Class_Col_Info')">
                <img src="../../static/Images/information_icon.png"
                     width="20"
                     height="20" />
                <span style="white-space: pre-wrap" class="popuptext" id="Class_col_Info">The column that contains the information to classify.</span>
            </div>
            <input id="class_col" type="text" name="class_col"> <br>

            <label>KDE (Kernel Density Estimates)'s ind value.</label>
            <div class="popup" onclick="popupInformation('KDE_IND_Info')">
                <img src="../../static/Images/information_icon.png"
                     width="20"
                     height="20" />
                <span style="white-space: pre-wrap" class="popuptext" id="KDE_IND_Info">A kernel density estimate (KDE) plot is a method for visualizing the distribution of observations in a dataset, analogous to a histogram. KDE represents the data using a continuous probability density curve in one or more dimensions.<br><br>Relative to a histogram, KDE can produce a plot that is less cluttered and more interpretable, especially when drawing multiple distributions. But it has the potential to introduce distortions if the underlying distribution is bounded or not smooth. Like a histogram, the quality of the representation also depends on the selection of good smoothing parameters.<br><br>Evaluation points for the estimated PDF. If None (default), 1000 equally spaced points are used. If ind is a NumPy array, the KDE is evaluated at the points passed. If ind is an integer, ind number of equally spaced points are used.</span>
            </div>
            <input id="kde_ind" type="text" name="kde_ind"> <br>

            <button type="submit" name="submit"> Check CSV file. </button>

            <p id="csv_Title">CSV values.</p>
            <div style="overflow: auto; max-height: 300px; max-width: 900px; ">
                <p id="csv_Results" style="background-color: white;"></p>
            </div>
            <p id="csv_Null_Title">Null instances.</p>
            <p id="csv_Null_Results" style="background-color: white;"></p>
            <p id="csv_Class_Balance_Title">Number of Class Instances.</p>
            <p id="csv_Class_Balance_Results" style="background-color: white;"></p>
            <p id="csv_Scale_Title">KDE plots for each class.</p>
            <div style="overflow: auto; max-height: 600px; max-width: 600px; ">
                <p id="csv_Scale_Results" style="background-color: white;"></p>
            </div>
            <p>&nbsp;</p>
        </form>


        <!-- Preprocess section-->
        <form id="preoptForm">
            <h2>
                Phase 2a. Preoptimization
                <!-- information to display for the preoptimization section -->
                <div class="popup" onclick="popupInformation('Experiment_Dataset_Info')">
                    <img src="../../static/Images/information_icon.png"
                         width="20"
                         height="20" />
                    <span style="white-space: pre-wrap" class="popuptext" id="Experiment_Preoptimization_Info">Currently not implemented. <br><br> Will eventually allow such optimization as balancing dataset, removing null values, fill null values with average, set all values to numberic, etc.</span>
                </div>
            </h2><br>

            <!-- Dynamically pull preoptimization options and create new identifyer when selected. -->
            {% if g.Algorithms %}
            Choose which preoptimization methods to apply:
            <select id="preopt" name="preopt" onselect="selectPreopt(this.id, 'Parameters')">
                {% for choices, infos in g.Preoptimizations%}
                <option value={{ choices }}>{{ choices }}</option>
                {% endfor %}
            </select>
            {% endif %}
            <button type="button" id="addPreoptButton" onclick="addPreopt()"> Add </button>

            <div id="Preopt_Selection"></div>

            <p>&nbsp;</p>

            <h3>-----------------------------------</h3>
        </form>


        <form id="cyconForm">
            <!-- Copy of information from prior sections -->
            <input id="projectName_copy" name="projectName" type="hidden" />
            <input id="phase1Text_copy" name="phase1Text" type="hidden" />
            <input id="csvFile_copy" name="csvFile" type="hidden" />

            <!-- Preoptimization options.-->

            <!-- Methodology section 1 -->
            {% if g.Methodologies %}
            <hr />
            <h2>Phase 3. Methodology.</h2><br>
            <hr />

            {% for choices, infos in g.Methodologies%}
            <input type="radio" id={{ choices }} name="methodology" value={{ choices }}> <label for={{ choices }}>{{ choices }}</label>
            {% for sentence in infos%}
            {% if sentence != null and sentence != ""%}
            <!-- information to display for the selectable methodology section
        Its a mess and will need to fix later as the onclick will not accept variables...-->
            {% if "MLA" in choices%}
            <div class="popup" onclick="popupInformation('MLA_info')">
                <img src="../../static/Images/information_icon.png"
                     width="20"
                     height="20" />
                <span style="white-space: pre-wrap" class="popuptext" id="MLA_info" }>{{ sentence }}</span>
            </div>
            <br>
            {% endif %}
            {% if "DLANN" in choices%}
            <div class="popup" onclick="popupInformation('DLANN_info')">
                <img src="../../static/Images/information_icon.png"
                     width="20"
                     height="20" />
                <span style="white-space: pre-wrap" class="popuptext" id="DLANN_info" }>{{ sentence }}</span>
            </div>
            <br>
            {% endif %}
            {% endif %}
            {% endfor %}
            {% endfor %}
            {% endif %}

            <!-- Section for MLA -->
            <div id="MLA_Options" class="methodology_desc">

                <!-- Algorithms section-->
                <h2>Phase 3a. Method.</h2><br>

                <!-- Dynamically pull algorithms names and create radio buttons for each choice-->
                {% if g.Algorithms %}
                Choose a Machine Learning Algorithm:
                <select id="MLalgorithm" name="MLalgorithm" onchange="changeAlgorithm(this.id, 'Parameters')">
                    {% for choices, infos in g.Algorithms%}
                    <option value={{ choices }}>{{ choices }}</option>
                    {% endfor %}
                </select>
                {% endif %}

                <br><br>
                For more information on MLA algorithms, visit  <a href="https://scikit-learn.org/stable/supervised_learning.html">scikit-learn.org</a>

                <p>&nbsp;</p>

                <h3>-----------------------------------</h3>

                <!-- Hyperparameters section-->

                <h2>Phase 3a_1. Algorithm Parameters.</h2><br>
                <!-- Dynamically pull hyperparameter names and create radio buttons for each choice-->
                <p>Check the parameters to change from default and provide selection.</p>
                <div id="Parameters"></div>

                <p>&nbsp;</p>

                <h3>-----------------------------------</h3>

                <!-- Validation section-->
                <h2>Phase 3b. Validation.</h2><br>

                <input type="radio" id=K-Fold name="validation" value=K-Fold> <label for=K-Fold>K-Fold</label>
                <div class="popup" onclick="popupInformation('K-Fold_Info')">
                    <img src="../../static/Images/information_icon.png"
                         width="20"
                         height="20" />
                    <span style="white-space: pre-wrap" class="popuptext" id="K-Fold_Info" }>K-Folds cross-validator<br><br>Provides train/test indices to split data in train/test sets. Split dataset into k consecutive folds (without shuffling by default).<br><br>Each fold is then used once as a validation while the k - 1 remaining folds form the training set.<br><br>Input values is the desired number of folds.</span>
                </div>
                <input type="text" id="K-Fold_Input" name="K-Fold_Input">
                <br>

                <input type="radio" id=Split name="validation" value=Split> <label for=Split>Split</label>
                <div class="popup" onclick="popupInformation('Split_Info')">
                    <img src="../../static/Images/information_icon.png"
                         width="20"
                         height="20" />
                    <span style="white-space: pre-wrap" class="popuptext" id="Split_Info" }>Split arrays or matrices into random train and test subsets.<br><br>Quick utility that wraps input validation, next(ShuffleSplit().split(X, y)), and application to input data into a single call for splitting (and optionally subsampling) data into a one-liner.<br><br>Input value is the percent set for the testing dataset given as a decimal.</span>
                </div>
                <input type="text" id="Split_Input" name="Split_Input">
                <br><br>

                <p>k-Fold: Number for the number of folds</p>
                <p>Split: The percentage for the training set. </p>
                <br><br>

                <p><b>Additional Options:</b></p><br>
                <label for=Random_State>Random State </label>
                <div class="popup" onclick="popupInformation('Random_State_Info')">
                    <img src="../../static/Images/information_icon.png"
                         width="20"
                         height="20" />
                    <span style="white-space: pre-wrap" class="popuptext" id="Random_State_Info" }>Whether to shuffle the data before splitting into batches. Note that the samples within each split will not be shuffled.</span>
                </div>
                <input type="text" id="Random_State_Input" name="Random_State_Input"><br>

                <label for=Shuffle>Shuffle </label>
                <div class="popup" onclick="popupInformation('Random_State_Info')">
                    <img src="../../static/Images/information_icon.png"
                         width="20"
                         height="20" />
                    <span style="white-space: pre-wrap" class="popuptext" id="Random_State_Info" }>When shuffle is True, random_state affects the ordering of the indices, which controls the randomness of each fold. Otherwise, this parameter has no effect. Pass an int for reproducible output across multiple function calls.</span>
                </div>
                <input type="radio" id="Shuffle_True" name="Shuffle" value=True> <label for="Shuffle_True">True</label>
                <input type="radio" id="Shuffle_False" name="Shuffle" value=False checked> <label for="Shuffle_False">False</label><br>

                <label for=Shuffle>Stratify. </label>
                <div class="popup" onclick="popupInformation('Stratify_Info')">
                    <img src="../../static/Images/information_icon.png"
                         width="20"
                         height="20" />
                    <span style="white-space: pre-wrap" class="popuptext" id="Stratify_Info" }>If not None, data is split in a stratified fashion, using this as the class labels.<br><br>When using split validation, set to true will statify on the class column information.<br>When usng k-fold, the method will use stratify k-fold.</span>
                </div>
                <input type="radio" id="Stratify_True" name="Stratify" value=True> <label for="Stratify_True">True</label>
                <input type="radio" id="Stratify_False" name="Stratify" value=False checked> <label for="Stratify_False">False</label><br>

                <p>&nbsp;</p>

                <h3>-----------------------------------</h3>
            </div>
            <!-- Section for DLANN -->
            <div id="DLANN_Options" class="methodology_desc">
                <!-- Methods section-->
                <h2>Phase 3a. Network.</h2><br>

                <!-- Dynamically pull methods names and create radio buttons for each choice-->
                <input type="radio" id=Method_BNN name="networks" value=network_BNN onclick=> <label for=Network_BNN>Basic Neural Network</label><br>
                <input type="radio" id=Method_CNN name="networks" value=network_CNN onclick=> <label for=Network_CNN>Convolutional Neural Network</label><br>

                <p>Basic Neural Network: (Info will be added later) </p>
                <p>Convolutional Neural Network: (Info will be added later) </p>

                <p>&nbsp;</p>

                <h3>-----------------------------------</h3>
            </div>

            <button type="submit" name="submit"> Perform Experiment </button>

        </form>

        <hr />
        <h2 id="resultsHeader">Phase 4. Results and Interpretation:</h2>
        <hr />

        <!-- Metrics section-->
        <h2>Phase 4a. Displayed Metrics.</h2><br>

        <form id="resultForm">

            <input type="checkbox" id=Met_ACC name="Met_ACC" value=Met_ACC checked> <label for=Met_ACC>ACC</label><br>
            <input type="checkbox" id=Met_Precision name="Met_Precision" value=Met_Precision checked> <label for=Met_Precision>Precision</label><br>
            <input type="checkbox" id=Met_Precision_Micro name="Met_Precision_Micro" value=Met_Precision_Micro checked> <label for=Met_Precision_Micro>Precision (Micro)</label><br>
            <input type="checkbox" id=Met_Precision_Macro name="Met_Precision_Macro" value=Met_Precision_Macro checked> <label for=Met_Precision_Macro>Precision (Macro)</label><br>
            <input type="checkbox" id=Met_F1 name="Met_F1" value=Met_F1 checked> <label for=Met_F1>F1</label><br>
            <input type="checkbox" id=Met_F1_Micro name="Met_F1_Micro" value=Met_F1_Micro checked> <label for=Met_F1_Micro>F1 (Micro)</label><br>
            <input type="checkbox" id=Met_F1_Macro name="Met_F1_Macro" value=Met_F1_Macro checked> <label for=Met_F1_Macro>F1 (Macro)</label><br>
            <input type="checkbox" id=Met_CM name="Met_CM" value=Met_CM checked> <label for=Met_CM>Confusion Matrix</label><br>


            <button type="submit"
                    name="submit">
                Update displayed metrics
            </button>
            <p>&nbsp;</p>

            <h3>-----------------------------------</h3>


            <!-- <input type="radio" id="method4" name="method" value="method4">
        <label for="method4"><i>Method developed by user (comming soon)</i></label><br>
        <h3>-----------------------------------</h3> -->
            <!-- <p>&nbsp;</p> -->
            <!-- <li style="font-size:12pt">Results</li> -->

            <p id="Status">Current Status of experiment.</p>
            <p id="StatusInfo"></p>
            <p>&nbsp;</p>
            <p id="Results_Title">RESULTS.</p>
            <p id="Results" style="background-color: white;"></p>

            <!-- <input id="displayResults" type="button" value="Show Results" class="displayResults"/> -->
            <p>&nbsp;</p>

            <!--
        <li style="font-size:12pt"> Analyzing the results</li>

        <canvas id="myChart" style="height: 370px; width: 100%;"></canvas>
        <p>&nbsp;</p>
            -->
            <li style="font-size:12pt">
                Generating a PDF report <button type="button"
                                                id="generateReport" onclick="generatePDF()">
                    Generate
                </button>
            </li>
            <p>&nbsp;</p>

            </ul>
            <p>&nbsp;</p>


        </form>

    </div>
</div>




<!-- This is the old javascript method for running LCA. Will need to change to json file, run on python and run on seprate vm later.-->
<script src="../../static/js/Cycon_events.js"></script>

<!-- This is the javascript method for running MLA-->>


<!-- The library for the charts -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
{% endblock %}
